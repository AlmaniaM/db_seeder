plugins {
    id 'java'
}

compileJava.options.encoding = 'UTF-8'
group 'ch.konnexions'
version '1.15.11'

repositories {
    jcenter()
    mavenCentral()
    maven {
        url "http://maven.cubrid.org/"
    }
}

dependencies {
    implementation 'com.h2database:h2:1.4.200'
    implementation 'com.ibm.db2:jcc:11.5.4.0'
    implementation 'com.ibm.informix:jdbc:4.50.4.1'
    implementation 'com.microsoft.sqlserver:mssql-jdbc:8.3.1.jre14-preview'
    implementation 'com.oracle.database.jdbc:ojdbc8:19.7.0.0'
    implementation 'commons-beanutils:commons-beanutils:1.9.4'
    implementation 'cubrid:cubrid-jdbc:10.2.1.8849'
    implementation 'io.crate:crate-jdbc:2.6.0'
    implementation 'mysql:mysql-connector-java:8.0.21'
    implementation 'org.apache.commons:commons-configuration2:2.7'
    implementation 'org.apache.commons:commons-csv:1.8'
    implementation 'org.apache.derby:derby:10.15.2.0'
    implementation 'org.apache.derby:derbyclient:10.15.2.0'
    implementation 'org.firebirdsql.jdbc:jaybird:4.0.0.java11'
    implementation 'org.hsqldb:hsqldb:2.5.1'
    implementation 'org.mariadb.jdbc:mariadb-java-client:2.6.1'
    implementation 'org.postgresql:postgresql:42.2.14'
    implementation 'org.slf4j:slf4j-log4j12:1.7.25'
    implementation 'org.xerial:sqlite-jdbc:3.31.1'
}

jar {
    archivesBaseName = project.name
    duplicatesStrategy = DuplicatesStrategy.INCLUDE

    manifest {
        attributes 'Main-Class' : 'ch.konnexions.db_seeder.DatabaseSeeder'
    }
}

task fatJar(type: Jar) {
    group = "Konnexions"
    description = 'Create a jar file including all dependencies'

    manifest.from jar.manifest
    archiveClassifier  = 'all'
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    } {
        exclude "META-INF/*.SF"
        exclude "META-INF/*.DSA"
        exclude "META-INF/*.RSA"
    }
    with jar
}

task copyJarToLib(type: Copy, dependsOn: 'fatJar') {
    group = "Konnexions"
    description = 'Create the jar file and copy it to the lib directory'

    from "$buildDir/libs"
    rename project.name + '-' + version + '-all.jar', project.name + '.jar'
    into "lib"
}

tasks.withType(JavaCompile).each {
    it.options.compilerArgs.add('--enable-preview')
    it.options.encoding = 'UTF-8'
}
